<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>GeoJSONLayer | Sample | ArcGIS Maps SDK for JavaScript 4.28</title>

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }

  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.28/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.28/"></script>

  <script>
    require(["esri/Map",
    "esri/layers/GeoJSONLayer", 
    "esri/views/MapView", 
    "esri/renderers/UniqueValueRenderer", 
    "esri/layers/FeatureLayer",
    "esri/layers/WebTileLayer",
    "esri/layers/support/TileInfo",
    "esri/layers/GroupLayer"
    ], (
      Map,
      GeoJSONLayer,
      MapView,
      UniqueValueRenderer,
      FeatureLayer,
      WebTileLayer, 
      TileInfo,
      GroupLayer 
    ) => {

      const map = new Map({
        basemap: "satellite",
        ground: "world-elevation",
      });

      const view = new MapView({
        container: "viewDiv",
        center: [-18, 65],
        zoom: 6,
        map: map
      });
    }); 

    /*
    //"modules/mapConfig",
    //"modules/basicWidgets",
    //"modules/weatherDaylight",
    //"modules/measurementWidget",
    //"modules/cameraPosition",
    "esri/config",
    "esri/WebMap",
    "esri/views/SceneView",
    "esri/Map",
    "esri/WebScene",
    "esri/Basemap",
    //"esri/widgets/Search",
    "esri/widgets/Legend",
    //"esri/widgets/Home",
    "esri/widgets/Weather",
    "esri/widgets/Daylight",
    "esri/widgets/LayerList", //Layer list to turn on/off layers visibility
    //"esri/widgets/DirectLineMeasurement3D",
    //"esri/widgets/AreaMeasurement3D",
    //"esri/widgets/TimeSlider",
    "esri/widgets/Expand",
    //"esri/core/promiseUtils",
    //"esri/core/reactiveUtils",
    //"esri/geometry/ElevationLayer"
    "esri/symbols/LabelSymbol3D",
    "esri/symbols/TextSymbol3DLayer",
    "esri/symbols/LineSymbol3D",
    "esri/symbols/Symbol3D",
    "esri/layers/GroupLayer",  
    "esri/widgets/LayerList",
    "esri/layers/support/LabelClass",
    "esri/layers/GeoJSONLayer", //Map and GeoJSON layer is needed for my experiment with adding Json layers.....
    "esri/layers/SceneLayer",
    "esri/layers/FeatureLayer",
    "esri/layers/OGCFeatureLayer",
    "esri/layers/WMSLayer",
    "esri/layers/WFSLayer",
    "esri/renderers/UniqueValueRenderer",
    "esri/layers/WebTileLayer",
    "esri/geometry/SpatialReference",
    "esri/layers/support/TileInfo",
    ], function(
      //MapConfig,
      //BasicWidgets,
      //WeatherDaylight,
      //MeasurementWidget,
      //CameraPosition,
      esriConfig,
      WebMap,
      SceneView,
      Map,
      WebScene, 
      Basemap,
      //Search,
      Legend,
      //Home,
      Weather, 
      Daylight, 
      LayerList,
      //DirectLineMeasurement3D,
      //AreaMeasurement3D,
      //TimeSlider,
      Expand,
      //promiseUtils,
      //reactiveUtils,
      //ElevationLayer
      LabelSymbol3D,
      TextSymbol3DLayer,
      LineSymbol3D,
      Symbol3D,
      GroupLayer, 
      LayerList, 
      LabelClass,
      GeoJSONLayer,
      SceneLayer,
      FeatureLayer,
      OGCFeatureLayer,
      WMSLayer,
      WFSLayer,
      UniqueValueRenderer,
      WebTileLayer,
      SpatialReference, 
      TileInfo,
      )/*

    /*
    const demTileInfo = new TileInfo.create({
          spatialReference: {
            wkid: 3057 // Set the WKID for EPSG:3057 projection
          },
          origin: {
            x: -161616,
            y: -72.00000049173832
          },
          lods: [
            { level: 0, resolution: 4096 },
            { level: 1, resolution: 2048 },
            { level: 2, resolution: 1024},
            { level: 3, resolution: 512 },
            { level: 4, resolution: 256 },
            { level: 5, resolution: 128 },
            { level: 6, resolution: 64 },
            { level: 7, resolution: 32 },
            { level: 8, resolution: 16 },
            { level: 9, resolution: 8 },
            { level: 10, resolution: 4 },
            { level: 11, resolution: 2 },
            { level: 12, resolution: 1 },
            { level: 13, resolution: 0.5 },
            { level: 14, resolution: 0.25 },
            { level: 15, resolution: 0.125 },
            { level: 16, resolution: 0.0625 },
            // Add other levels as per your requirement
          ],
          size: [256, 256] // Tile size
        });
          // Web Tile Layer DEM
          const demLayer = new WebTileLayer({
            urlTemplate: "https://gis.lmi.is/mapcache/tms/1.0.0/IslandsDEMDaylight@EPSG:3057/{z}/{x}/{-y}.png",
            //copyright: 'Map data from &copy; <a href="https://www.loftmyndir.is/" target="_blank">Loftmyndir</a> Map design by &copy; <a href="http://opentopomap.org/" target="_blank">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank">CC-BY-SA</a>) contributors'
            title: "ÍslandsDEM",
            spatialReference: {
              wkid: 3057 // Set the WKID for EPSG:3057 projection
            },
            //tileInfo: demTileInfo,
          });
      map.add(demLayer);*/
      

      // Create the FeatureLayer with multiple polygons
      const obnLoadLayer = new FeatureLayer({
            url: "https://services.arcgis.com/oMbONQQmfNuIEo3g/arcgis/rest/services/obyggdanefnd_dranga_epsg3857/FeatureServer",
        });

        // Create a GroupLayer to contain individual polygons
        const obnLayer = new GroupLayer({
            title: "Óbyggðanefnd",
            visible: true
        });
        obnLayer.elevationInfo ={
            mode: "on-the-ground",
        };

        // Fetch features from the FeatureLayer and create individual FeatureLayers for each polygon
        obnLoadLayer.load().then(() => {
            // Get the features
            obnLoadLayer.queryFeatures().then((result) => {
                const features = result.features;

                // Create a FeatureLayer for each individual polygon
                features.forEach((feature, index) => {
                    const singleFeatureOBNLayer = new FeatureLayer({
                        source: [feature], // Provide the individual feature
                        objectIdField: "fid", // Replace with your object ID field
                        title: `Mörk ${index + 1}`, // Title for the layer
                        visible: true, // Set initial visibility as needed
                        // Add any other properties or configurations for the layer
                        //popupTemplate: templateObyggdanefnd,
                        renderer: rendererObyggdanefnd,
                        popupTemplate: {
                          title: "{gogn}",
                          fieldInfos: [
                            {
                              fieldName: 'gogn',
                            }
                          ]
                        },
                        opacity: 0.7,
                    });

                    obnLayer.add(singleFeatureOBNLayer); // Add the FeatureLayer to the GroupLayer
                });
            });
        });


  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>